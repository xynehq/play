#!/usr/bin/env python3

import argparse
import sys
from pathlib import Path

# Add current directory to path to import orchestrator
sys.path.insert(0, str(Path(__file__).parent))

from orchestrator import run_pr


def parse_args() -> argparse.Namespace:
    parser = argparse.ArgumentParser(
        description="Run PR automation pipeline with automated Stage 0 (PR setup)",
        epilog="""
Examples:
  # Run with automatic PR setup (recommended)
  ./run_pr 9298
  
  # Run with specific models
  ./run_pr 9298 --models minimax-m2,glm-full
  
  # Skip Stage 0 if PR setup was done manually via pr_analyzer.sh
  ./run_pr 9298 --skip-setup
        """
    )
    parser.add_argument("pr_number", help="PR number to process")
    parser.add_argument(
        "--models",
        help="Comma-separated list of models (e.g., minimax-m2,glm-full). Defaults to minimax-m2",
    )
    parser.add_argument(
        "--skip-setup",
        action="store_true",
        help="Skip Stage 0 (PR setup). Use if you already ran pr_analyzer.sh manually",
    )
    return parser.parse_args()


def main():
    """Main CLI entry point for run_pr command."""
    args = parse_args()
    models = args.models.split(",") if args.models else None
    run_pr(args.pr_number, models=models, skip_setup=args.skip_setup)


if __name__ == "__main__":
    main()
